const DEFAULT_TIMER=1e3,GOON_BLOCK_HEIGHT=930,ADMIN_NAMES=["MOD","ADMIN"];let USER_COLOR,USER_NAME;$(document).ready((function(){$(".room-login").modal("show"),$(".room-login").modal("show"),initSocketConnection(),updateWoundLsevel(),updateChatPositioning(),addBorderToBottom(),mapAimMods()}));const mapAimMods=()=>{AIM_MODS=JSON.parse(AIM_MODS.replace(/&#34;/g,'"'))},initSocketConnection=()=>{const t=io("/");t.on("connect",(()=>{console.log("Successfuly established socket connection"),t.emit("init-room-connection",ROOM_ID)})),t.on("message-created",(t=>{$(".messages").append(`<li class="message"><span><span style="color:${t.user.color}" class="name">${t.user.name}: </span><span class="msg">${t.msg}</span></span></li>`),scrollToBottom()})),t.on("roll-calculated",(t=>{t.specMsg?$(".messages").append(`<li class="message"><span><span style="color:${t.user.color}" class="name">${t.specMsg}<span></li>`):t.error?$(".messages").append(`<li class="message"><span><span style="color:${t.user.color}" class="name">Roll failed: inadequade roll value! <span></li>`):$(".messages").append(`<li class="message"><span><span style="color:${t.user.color}" class="name">${t.user.name} rolled: </span><span class="msg">${t.roll.join(", ")} (${t.result})</span></li>`)})),t.on("user-disconnected",(t=>{t.name&&$(".messages").append(`<li class="message-centered"><span style="color: ${t.color}">${t.name} disconnected!</span></li>`)})),t.on("user-joined",(t=>{t.name===USER_NAME&&(USER_COLOR=t.color),$(".messages").append(`<li class="message-centered"><span style="color: ${t.color}">${t.name} connected!</span></li>`),isAdmin()&&$(".blur-details").length<1&&($(".header-buttons").prepend('<button type="button" class="btn btn-danger blur-details blur">Hide Details from Buddys</button>'),$(".header-buttons").prepend('<button type="button" class="btn btn-primary blur-details unblur inactive">Show Details to your Buddys</button>'))})),t.on("goon-added",(t=>{t.name!==USER_NAME&&addGoon(t.goon.id,t.type),updateShooterList()})),t.on("goon-updated",(t=>{let n=!1;const e=$(`.${t.type}.${t.goon.id}`);if(e.length>0){const a=$(e[0]),s=t.goon,o=s.fightStats.selectedMods,i=a.find(".goon-name").attr("data-initial-value");a.find(".head").val(s.bodyStats.armor.head),a.find(".torso").val(s.bodyStats.armor.torso),a.find(".l-arm").val(s.bodyStats.armor.lArm),a.find(".r-arm").val(s.bodyStats.armor.rArm),a.find(".l-leg").val(s.bodyStats.armor.lLeg),a.find(".r-leg").val(s.bodyStats.armor.rLeg),a.find(".head-hp").val(s.bodyStats.limbs.head),a.find(".torso-hp").val(s.bodyStats.limbs.torso),a.find(".l-arm-hp").val(s.bodyStats.limbs.lArm),a.find(".r-arm-hp").val(s.bodyStats.limbs.rArm),a.find(".l-leg-hp").val(s.bodyStats.limbs.lLeg),a.find(".r-leg-hp").val(s.bodyStats.limbs.rLeg),a.find(".fighter-stat-row .initial-ref").val(s.fightStats.initialRef),a.find(".fighter-stat-row .ref").val(s.fightStats.ref),a.find(".fighter-stat-row .initial-body").val(s.fightStats.initialBody),a.find(".fighter-stat-row .body").val(s.fightStats.body),a.find(".fighter-stat-row .initial-btm").val(s.fightStats.initialBtm),a.find(".fighter-stat-row .btm").val(s.fightStats.btm),a.find(".fighter-stat-row .wpn").val(s.fightStats.wpn),a.find(".fighter-stat-row .def").val(s.fightStats.def),a.find(".fighter-stat-row .mods").val(s.fightStats.mods),i!==s.additionalStats.name&&(n=!0),a.find(".goon-name").val(s.additionalStats.name),a.find(".goon-name").attr("data-initial-value",s.additionalStats.name),a.find(".wound-level-number").val(s.woundLevel),updateWoundLsevel(a),updateGoonMods(a,o),colorDynamicFields(a),t.name!==USER_NAME&&(a.addClass("changed"),setTimeout((()=>a.removeClass("changed")),500))}n&&updateShooterList()})),t.on("goon-removed",(t=>{removeGoon(t.id,t.type),updateShooterList()})),t.on("calculation-completed",(t=>{$("#battleLog .logs").empty().append(t.logStr).addClass("changed"),setTimeout((()=>$("#battleLog .logs").removeClass("changed")),500)})),t.on("blur-details",(()=>{isAdmin()||blurDetails()})),t.on("unblur-details",(()=>{unblurDetails()})),t.on("goons-imported",(t=>{try{renderGoons(t),importSucceded("Goons")}catch(t){console.log(t),importFailed()}})),t.on("bois-imported",(t=>{try{renderBois(t),importSucceded("Bois")}catch(t){console.log(t),importFailed()}})),initHandlers(t)},colorDynamicFields=t=>{const n=t.find(".fighter-stat-row .initial-ref"),e=t.find(".fighter-stat-row .ref"),a=parseInt(n.val()),s=parseInt(e.val());s>a?e.addClass("more-than"):s<a?e.addClass("less-than"):e.removeClass("more-than").removeClass("less-than");const o=t.find(".fighter-stat-row .initial-body"),i=t.find(".fighter-stat-row .body"),l=parseInt(o.val()),d=parseInt(i.val());d>l?i.addClass("more-than"):d<l?i.addClass("less-than"):i.removeClass("more-than").removeClass("less-than");const r=t.find(".fighter-stat-row .initial-btm"),c=t.find(".fighter-stat-row .btm"),u=parseInt(r.val()),p=parseInt(c.val());p>u?c.addClass("more-than"):p<u?c.addClass("less-than"):c.removeClass("more-than").removeClass("less-than")},renderGoons=t=>{$(".goons-block").empty();for(let n=0;n<t.length;n++){addGoon(t[n].id,"goon");const e=$(`.goon.${t[n].id}`);if(e.length>0){const a=$(e[0]),s=t[n],o=s.fightStats.selectedMods;a.find(".head").val(s.bodyStats.armor.head),a.find(".torso").val(s.bodyStats.armor.torso),a.find(".l-arm").val(s.bodyStats.armor.lArm),a.find(".r-arm").val(s.bodyStats.armor.rArm),a.find(".l-leg").val(s.bodyStats.armor.lLeg),a.find(".r-leg").val(s.bodyStats.armor.rLeg),a.find(".head-hp").val(s.bodyStats.limbs.head),a.find(".torso-hp").val(s.bodyStats.limbs.torso),a.find(".l-arm-hp").val(s.bodyStats.limbs.lArm),a.find(".r-arm-hp").val(s.bodyStats.limbs.rArm),a.find(".l-leg-hp").val(s.bodyStats.limbs.lLeg),a.find(".r-leg-hp").val(s.bodyStats.limbs.rLeg),a.find(".fighter-stat-row .initial-ref").val(s.fightStats.initialRef),a.find(".fighter-stat-row .ref").val(s.fightStats.ref),a.find(".fighter-stat-row .def").val(s.fightStats.def),a.find(".fighter-stat-row .initial-body").val(s.fightStats.initialBody),a.find(".fighter-stat-row .body").val(s.fightStats.body),a.find(".fighter-stat-row .initial-btm").val(s.fightStats.initialBtm),a.find(".fighter-stat-row .btm").val(s.fightStats.btm),a.find(".fighter-stat-row .wpn").val(s.fightStats.wpn),a.find(".fighter-stat-row .mods").val(s.fightStats.mods),colorDynamicFields(a),a.find(".goon-name").val(s.additionalStats.name),a.find(".wound-level-number").val(s.woundLevel),updateWoundLsevel(a),updateGoonMods(a,o)}}updateShooterList()},renderBois=t=>{$(".bois-block").empty();for(let n=0;n<t.length;n++){addGoon(t[n].id,"man");const e=$(`.boi.${t[n].id}`);if(e.length>0){const a=$(e[0]),s=t[n],o=s.fightStats.selectedMods;a.find(".head").val(s.bodyStats.armor.head),a.find(".torso").val(s.bodyStats.armor.torso),a.find(".l-arm").val(s.bodyStats.armor.lArm),a.find(".r-arm").val(s.bodyStats.armor.rArm),a.find(".l-leg").val(s.bodyStats.armor.lLeg),a.find(".r-leg").val(s.bodyStats.armor.rLeg),a.find(".head-hp").val(s.bodyStats.limbs.head),a.find(".torso-hp").val(s.bodyStats.limbs.torso),a.find(".l-arm-hp").val(s.bodyStats.limbs.lArm),a.find(".r-arm-hp").val(s.bodyStats.limbs.rArm),a.find(".l-leg-hp").val(s.bodyStats.limbs.lLeg),a.find(".r-leg-hp").val(s.bodyStats.limbs.rLeg),a.find(".fighter-stat-row .initial-ref").val(s.fightStats.initialRef),a.find(".fighter-stat-row .ref").val(s.fightStats.ref),a.find(".fighter-stat-row .def").val(s.fightStats.def),a.find(".fighter-stat-row .initial-body").val(s.fightStats.initialBody),a.find(".fighter-stat-row .body").val(s.fightStats.body),a.find(".fighter-stat-row .initial-btm").val(s.fightStats.initialBtm),a.find(".fighter-stat-row .btm").val(s.fightStats.btm),a.find(".fighter-stat-row .wpn").val(s.fightStats.wpn),a.find(".fighter-stat-row .mods").val(s.fightStats.mods),colorDynamicFields(a),a.find(".goon-name").val(s.additionalStats.name),a.find(".wound-level-number").val(s.woundLevel),updateWoundLsevel(a),updateGoonMods(a,o)}}updateShooterList()},updateGoonMods=(t,n)=>{t.find(".aim-modifiers-list .modifier").removeClass("active");for(let e=0;e<n.length;e++)t.find(".modifier-text:contains("+n[e]+")").parent().addClass("active")},blurDetails=()=>{$("\n    .goons-block .additional-info,\n    .goons-block .armor-block input\n  ").addClass("to-blur"),$(".logs").addClass("to-blur-light")},unblurDetails=()=>{$("\n    .goons-block .additional-info,\n    .goons-block .armor-block input\n  ").removeClass("to-blur"),$(".logs").removeClass("to-blur-light")},isAdmin=()=>ADMIN_NAMES.includes(USER_NAME),initHandlers=t=>{const n=$("#chat-input");$("html").on("keydown",(function(e){13==e.which&&n.val()&&(t.emit("message",{user:{name:USER_NAME,color:USER_COLOR},msg:n.val()}),chatInputWords=n.val().split(" "),n.val(""),"roll"===chatInputWords[0]&&t.emit("roll",{user:{name:USER_NAME,color:USER_COLOR},roll:chatInputWords[1]}))})),$(".close-chat").on("click",(function(){$(this).addClass("inactive"),$(".open-chat").removeClass("inactive"),$(".main-right").addClass("inactive"),$(".main-left").addClass("full-width")})),$(".open-chat").on("click",(function(){$(this).addClass("inactive"),$(".close-chat").removeClass("inactive"),$(".main-right").removeClass("inactive"),$(".main-left").removeClass("full-width")})),$(".connect-to-room").on("click",(function(){$("#punkName").val()&&(USER_NAME=$("#punkName").val(),$(".room-login").modal("hide"),t.emit("join-chat-room",{name:USER_NAME,socketId:t.id}))})),$(".add-goon").on("click",(function(){const n=$(".goon").length;addGoon(n,"goon"),t.emit("add-goon",{type:"goon",goonId:n,name:USER_NAME})})),$(".add-boi").on("click",(function(){const n=$(".boi").length;addGoon(n,"man"),t.emit("add-goon",{type:"man",goonId:n,name:USER_NAME})})),$(".rumble-button").on("click",(function(){const n={shooter:$(".step1 .target-select").val(),target:$(".step2 .target-select").val(),coverValue:parseInt($(".cover-value").val())?parseInt($(".cover-value").val()):0,fireMod:$(".fire-mod").val(),calledShot:$(".called-shot").val(),wpnDmg:$(".wpn-dmg").val(),wpnAcc:parseInt($(".wpn-acc").val()),wpnBullets:parseInt($(".wpn-bullets").val()),shotComplexity:parseInt($(".complexity-value").val()),range:$(".range").val(),ap:$(".ap").val(),isMelee:$(".ranged-switch").is(":visible"),meleeMod:$(".melee-fire-mod").val(),meleeTechnique:$(".melee-fist-type").val(),calledShotMelee:$(".called-shot-melee").val(),defenderAction:$(".defender-action").val(),defenderArmor:$(".defender-armor").val(),parryAction:$(".parry-option").val(),wpnDmgMelee:$(".wpn-dmg-melee").val(),wpnAccMelee:parseInt($(".wpn-acc-melee").val()),coverValueMelee:parseInt($(".cover-value-melee").val())?parseInt($(".cover-value-melee").val()):0,wpnHits:parseInt($(".wpn-hits-melee").val()),useBody:$(".body-dmg").val()};t.emit("count-battle",{data:n})})),$(document.body).on("click",".category-title i",(function(){const n=$(this).parent().parent().parent(),e=n.attr("class").split(/\s+/);$(`.${e[0]}.${e[1]} .wound-square`).removeClass("active-confirmed");const a=formGoonObj(n);t.emit("update-goon",{type:a.type,goonTemplate:a.goonTemplate,name:USER_NAME})})),$(document.body).on("click touchstart touchend touchmove",".wound-square",(function(){const n=$(this).parent().parent().parent().parent().parent(),e=n.attr("class").split(/\s+/),a=$(`.${e[0]}.${e[1]} .wound-square`),s=a.index(this);a.removeClass("active-confirmed");for(let t=0;t<s+1;t++)$(a[t]).addClass("active-confirmed");const o=formGoonObj(n);t.emit("update-goon",{type:o.type,goonTemplate:o.goonTemplate,name:USER_NAME})})),$(document.body).on("mouseover",".wound-square",(function(){const t=$(this).parent().parent().parent().parent().parent().attr("class").split(/\s+/),n=$(`.${t[0]}.${t[1]} .wound-square`),e=n.index(this);for(let t=0;t<e;t++)$(n[t]).addClass("active")})),$(document.body).on("mouseout",".wound-square",(function(){$(".wound-square").removeClass("active");const t=$(this).parent().parent().parent().parent().parent().attr("class").split(/\s+/),n=$(`.${t[0]}.${t[1]} .wound-square`),e=n.index(this);for(let t=0;t<e;t++)$(n[t]).removeClass("active")})),$(document.body).on("click",".remove-goon",(function(){const n=$(this).parent().parent().parent().parent().attr("class").split(/\s+/),e=n[0],a=n[1];t.emit("remove-goon",{type:e,id:a,name:USER_NAME})})),$(document.body).on("click",".blur",(function(){$(this).addClass("inactive"),$(".unblur").removeClass("inactive"),t.emit("blur-details",{})})),$(document.body).on("click",".unblur",(function(){$(this).addClass("inactive"),$(".blur").removeClass("inactive"),t.emit("unblur-details",{})})),$(document.body).on("change",".target-select",(function(){const t=$(this).hasClass("shooter")?"shooter-selected":"target-selected";$(".people").addClass("fighter-select"),$(".goon, .boi").removeClass(t);const n=$(this).val();if(n){const e="."+n.split("-").join(".");$(e).removeClass("non-target").addClass(t)}resetTargets()})),$(document.body).on("keyup change focusout",".armor-block input",debounce((function(){const n=formGoonObj($(this).closest(".goon, .boi"));t.emit("update-goon",{type:n.type,goonTemplate:n.goonTemplate,name:USER_NAME})}),1e3)),$(document.body).on("keyup change focusout",".fighter-stat-row input",debounce((function(){const n=formGoonObj($(this).closest(".goon, .boi"));t.emit("update-goon",{type:n.type,goonTemplate:n.goonTemplate,name:USER_NAME})}),1e3)),$(document.body).on("keyup change focusout",".personal-stats input",debounce((function(){const n=formGoonObj($(this).closest(".goon, .boi"));t.emit("update-goon",{type:n.type,goonTemplate:n.goonTemplate,name:USER_NAME})}),1e3)),$(document.body).on("click",".decrement",(function(){const t=$(this).closest(".input-block").find("input");let n=parseInt($(t).val());isNaN(n)&&(n=0),n>0?n--:0===n&&$(t).hasClass("hp")&&(n="-"),$(t).val(n).trigger("change")})),$(document.body).on("click",".increment",(function(){const t=$(this).closest(".input-block").find("input");let n=parseInt($(t).val());isNaN(n)&&(n=0),n++,$(t).val(n).trigger("change")})),$(document.body).on("click",".modifier",(function(){const t=$(this).hasClass("active"),n=$(this).find(".modifier-value").text().trim(),e=$(this).parent().parent().parent().parent().parent();t?$(this).removeClass("active"):$(this).addClass("active"),updateModsString(e,n,t)})),$(document.body).on("click",".export-goons",(function(){$.ajax({type:"GET",url:"/"+ROOM_ID+"/export-goons",success:function(t){download(t),donwloadSucceeded("Goon Pack")},error:function(t){downloadFailed(),console.log(t)}})})),$(document.body).on("click",".export-bois",(function(){$.ajax({type:"GET",url:"/"+ROOM_ID+"/export-bois",success:function(t){download(t),donwloadSucceeded("Bois Pack")},error:function(t){downloadFailed(),console.log(t)}})})),$(document.body).on("click",".import-goons",(async function(){let[n]=await window.showOpenFilePicker();const e=await n.getFile(),a=await e.text();t.emit("import-goons",JSON.parse(decodeURIComponent(a)))})),$(document.body).on("click",".import-bois",(async function(){let[n]=await window.showOpenFilePicker();const e=await n.getFile(),a=await e.text();t.emit("import-bois",JSON.parse(decodeURIComponent(a)))})),$(document.body).on("click",".shooter-selector",(function(){$(".shooter-selector").not(this).removeClass("active");$(this).hasClass("active")?($(this).removeClass("active"),unsetShooter()):($(this).addClass("active"),setShooter($(this)))})),$(document.body).on("click",".target-selector",(function(){$(".target-selector").not(this).removeClass("active");$(this).hasClass("active")?($(this).removeClass("active"),unsetTarget()):($(this).addClass("active"),setTarget($(this)))})),$(document.body).on("click",".battle-mode-switcher",(function(){$(".battle-mode-switcher, .ranged, .melee").toggleClass("inactive")}))},handleModChange=t=>{t&&$(".ranged").addClass("inactive");const n=!1===t?"melee":"ranged";$("."+(!0===t?"ranged":"melee")).addClass("inactive"),$("."+n).removeClass("inactive")},setShooter=t=>{const n=t.parent().parent().parent().attr("class").split(/\s+/).slice(0,2).join("-");$(".shooter").val(n).change()},unsetShooter=()=>{$(".shooter").val("").change()},setTarget=t=>{const n=t.parent().parent().parent().attr("class").split(/\s+/).slice(0,2).join("-");$(".target").val(n).change()},unsetTarget=()=>{$(".target").val("").change()},download=t=>{const n=JSON.stringify(t,null,2);let e=document.createElement("a");e.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(n)),e.setAttribute("download","goons.json"),e.style.display="none",document.body.appendChild(e),e.click(),document.body.removeChild(e)},donwloadSucceeded=t=>{$.toast({text:"Successfully Downloaded Template :)",heading:`${t} Donwloaded`,icon:"success",showHideTransition:"slide",allowToastClose:!0,hideAfter:5e3,stack:5,position:{right:40,bottom:35},textAlign:"left",loader:!0,loaderBg:"#9EC600",beforeShow:function(){},afterShown:function(){},beforeHide:function(){},afterHidden:function(){}})},downloadFailed=()=>{$.toast({text:"Failed to download template",heading:"Template Download Failed",icon:"error",showHideTransition:"slide",allowToastClose:!0,hideAfter:5e3,stack:5,position:{right:40,bottom:35},textAlign:"left",loader:!0,loaderBg:"#9EC600",beforeShow:function(){},afterShown:function(){},beforeHide:function(){},afterHidden:function(){}})},importSucceded=t=>{$.toast({text:`Successfully Imported ${t} :)`,heading:`${t} Imported`,icon:"success",showHideTransition:"slide",allowToastClose:!0,hideAfter:5e3,stack:5,position:{right:40,bottom:35},textAlign:"left",loader:!0,loaderBg:"#9EC600",beforeShow:function(){},afterShown:function(){},beforeHide:function(){},afterHidden:function(){}})},importFailed=()=>{$.toast({text:"Failed to import goons",heading:"Goons import failed",icon:"error",showHideTransition:"slide",allowToastClose:!0,hideAfter:5e3,stack:5,position:{right:40,bottom:35},textAlign:"left",loader:!0,loaderBg:"#9EC600",beforeShow:function(){},afterShown:function(){},beforeHide:function(){},afterHidden:function(){}})},updateModsString=(t,n,e)=>{const a=$(t).find(".mods");const s=a.val().split(" "),o=s.indexOf(n);o>-1?e?s.splice(o,1):s.push(n):e||s.push(n);let i=s.join(" ");a.val(i).trigger("change")},scrollToBottom=()=>{const t=$(".main-chat-window");t.scrollTop(t.prop("scrollHeight"))},resetTargets=()=>{""===$(".target-select.shooter").val()&&""===$(".target-select.target").val()&&$(".people").removeClass("fighter-select")};function updateShooterList(){$(".shooter-selector, .target-selector").removeClass("active"),$(".people").removeClass("fighter-select"),$(".goon, .boi").removeClass("shooter-selected").removeClass("target-selected"),$(".target-select").each(((t,n)=>{$(n).empty(),$(n).append('<option selected value="">Asignee</option>');for(let t=0;t<$(".boi").length;t++){const e=$(".boi."+t).find(".goon-name").val();$(n).append(`<option selected value="boi-${t}">${e||"Boi "+t}</option>`)}for(let t=0;t<$(".goon").length;t++){const e=$(".goon."+t).find(".goon-name").val();$(n).append(`<option selected value="goon-${t}">${e||"Goon "+t}</option>`)}$(n).val("")}))}function addBorderToBottom(){930===$(".goons-block").height()&&$(".goons-block").addClass("bottom-bordered"),930===$(".bois-block").height()&&$(".bois-block").addClass("bottom-bordered")}function updateChatPositioning(){$(window).width()<=1024&&$(".close-chat").trigger("click")}function populateAimMods(){let t="";for(let n in AIM_MODS)t+=`\n        <div class="modifier" id="${n}">\n          <div class="modifier-text">\n              ${n}\n          </div>\n          <div class="modifier-value">\n              ${AIM_MODS[n]}\n          </div>\n        </div>\n    `;return t}function updateWoundLsevel(t){let n=[];if(t?n.push(t):n=$(".goon, .boi"),n.length>0)for(let t=0;t<n.length;t++){const e=parseInt($(n[t]).find(".wound-level-number").val()),a=$(n[t]).find(".wound-square");if(e>0){a.removeClass("active-confirmed");for(let t=0;t<e;t++)$(a[t]).addClass("active-confirmed")}else a.removeClass("active-confirmed")}}function addGoon(t,n){let e="",a="",s="";"goon"===n?(e=".goons-block",a="goon",s="goon"):(e=".bois-block",a="boi",s="detective"),$(e).append(`\n  <div class="${a} ${t}">\n    <input type="hidden" class="wound-level-number" value="0">\n    <div class="left-info">\n      <div class="armor-block">\n        <img class="shooter-selector" src="goon-icons/action-icons/gun.svg"/>\n        <img class="target-selector" src="goon-icons/action-icons/target.svg"/>\n        <div class="input-block armor head-block">\n            <span class="input-group-btn">\n              <button type="button" class="quantity-left-minus btn btn-danger btn-number decrement"  data-type="minus" data-field="">\n                -\n              </button>\n            </span>\n            <input type="number" class="head" placeholder="Head Armor Value"  value="0">\n            <span class="input-group-btn">\n              <button type="button" class="quantity-right-plus btn btn-success btn-number increment" data-type="plus" data-field="">\n                +\n              </button>\n          </span>\n        </div>\n        <div class="input-block armor torso-block">\n            <span class="input-group-btn">\n              <button type="button" class="quantity-left-minus btn btn-danger btn-number decrement"  data-type="minus" data-field="">\n                -\n              </button>\n            </span>\n            <input type="number" class="torso" placeholder="Torso Armor Value"  value="0">\n            <span class="input-group-btn">\n              <button type="button" class="quantity-right-plus btn btn-success btn-number increment" data-type="plus" data-field="">\n                +\n              </button>\n          </span>\n        </div>\n        <div class="input-block armor r-arm-block">\n            <span class="input-group-btn">\n              <button type="button" class="quantity-left-minus btn btn-danger btn-number decrement"  data-type="minus" data-field="">\n                -\n              </button>\n            </span>\n            <input type="number" class="r-arm" placeholder="R-arm Armor Value"  value="0">\n            <span class="input-group-btn">\n              <button type="button" class="quantity-right-plus btn btn-success btn-number increment" data-type="plus" data-field="">\n                +\n              </button>\n          </span>\n        </div>\n        <div class="input-block armor l-arm-block">\n            <span class="input-group-btn">\n              <button type="button" class="quantity-left-minus btn btn-danger btn-number decrement"  data-type="minus" data-field="">\n                -\n              </button>\n            </span>\n            <input type="number" class="l-arm" placeholder="L-arm Armor Value"  value="0">\n            <span class="input-group-btn">\n              <button type="button" class="quantity-right-plus btn btn-success btn-number increment" data-type="plus" data-field="">\n                +\n              </button>\n          </span>\n        </div>\n        <div class="input-block armor r-leg-block">\n            <span class="input-group-btn">\n              <button type="button" class="quantity-left-minus btn btn-danger btn-number decrement"  data-type="minus" data-field="">\n                -\n              </button>\n            </span>\n            <input type="number" class="r-leg" placeholder="R-leg Armor Value"  value="0">\n            <span class="input-group-btn">\n              <button type="button" class="quantity-right-plus btn btn-success btn-number increment" data-type="plus" data-field="">\n                +\n              </button>\n          </span>\n        </div>\n        <div class="input-block armor l-leg-block">\n            <span class="input-group-btn">\n              <button type="button" class="quantity-left-minus btn btn-danger btn-number decrement"  data-type="minus" data-field="">\n                -\n              </button>\n            </span>\n            <input type="number" class="l-leg" placeholder="L-leg Armor Value"  value="0">\n            <span class="input-group-btn">\n              <button type="button" class="quantity-right-plus btn btn-success btn-number increment" data-type="plus" data-field="">\n                +\n              </button>\n          </span>\n        </div>\n        <div class="input-block armor head-hp-block">\n            <span class="input-group-btn">\n              <button type="button" class="quantity-left-minus btn btn-danger btn-number decrement"  data-type="minus" data-field="">\n                -\n              </button>\n            </span>\n            <input type="text" class="head-hp hp" placeholder="Head hp Value"  value="-">\n            <span class="input-group-btn">\n              <button type="button" class="quantity-right-plus btn btn-success btn-number increment" data-type="plus" data-field="">\n                +\n              </button>\n          </span>\n        </div>\n        <div class="input-block armor torso-hp-block">\n            <span class="input-group-btn">\n              <button type="button" class="quantity-left-minus btn btn-danger btn-number decrement"  data-type="minus" data-field="">\n                -\n              </button>\n            </span>\n            <input type="text" class="torso-hp hp" placeholder="Torso hp Value"  value="-">\n            <span class="input-group-btn">\n              <button type="button" class="quantity-right-plus btn btn-success btn-number increment" data-type="plus" data-field="">\n                +\n              </button>\n          </span>\n        </div>\n        <div class="input-block armor r-arm-hp-block">\n            <span class="input-group-btn">\n              <button type="button" class="quantity-left-minus btn btn-danger btn-number decrement"  data-type="minus" data-field="">\n                -\n              </button>\n            </span>\n            <input type="text" class="r-arm-hp hp" placeholder="R-arm hp Value"  value="-">\n            <span class="input-group-btn">\n              <button type="button" class="quantity-right-plus btn btn-success btn-number increment" data-type="plus" data-field="">\n                +\n              </button>\n          </span>\n        </div>\n        <div class="input-block armor l-arm-hp-block">\n            <span class="input-group-btn">\n              <button type="button" class="quantity-left-minus btn btn-danger btn-number decrement"  data-type="minus" data-field="">\n                -\n              </button>\n            </span>\n            <input type="text" class="l-arm-hp hp" placeholder="L-arm hp Value"  value="-">\n            <span class="input-group-btn">\n              <button type="button" class="quantity-right-plus btn btn-success btn-number increment" data-type="plus" data-field="">\n                +\n              </button>\n          </span>\n        </div>\n        <div class="input-block armor r-leg-hp-block">\n            <span class="input-group-btn">\n              <button type="button" class="quantity-left-minus btn btn-danger btn-number decrement"  data-type="minus" data-field="">\n                -\n              </button>\n            </span>\n            <input type="text" class="r-leg-hp hp" placeholder="R-leg hp Value"  value="-">\n            <span class="input-group-btn">\n              <button type="button" class="quantity-right-plus btn btn-success btn-number increment" data-type="plus" data-field="">\n                +\n              </button>\n          </span>\n        </div>\n        <div class="input-block armor l-leg-hp-block">\n            <span class="input-group-btn">\n              <button type="button" class="quantity-left-minus btn btn-danger btn-number decrement"  data-type="minus" data-field="">\n                -\n              </button>\n            </span>\n            <input type="text" class="l-leg-hp hp" placeholder="L-leg hp Value"  value="-">\n            <span class="input-group-btn">\n              <button type="button" class="quantity-right-plus btn btn-success btn-number increment" data-type="plus" data-field="">\n                +\n              </button>\n          </span>\n        </div>\n        <img src="goon-icons/${s}.png">\n        <div class="buttons-block">\n          <button type="button" class="btn btn-danger remove-goon">Kill</button>\n        </div>\n       \n      </div>\n      <div class="personal-info">\n        <h6 class="category-title personal-title">\n          Personal Info <i class="material-icons">control_point</i>\n        </h6>\n        <div class="personal-stats">\n          <div class="form-group fighter-stat-row">\n              <label for="goon-name">NAME</label>\n              <input type="text" class="form-control goon-name" aria-describedby="name-hint" placeholder="NAME" value="" data-initial-value="">\n              <small id="name-hint" class="form-text text-muted">You were 0 and still...</small>\n          </div>\n          <h6 class="category-title personal-title aim-mods-title">\n            Fast Aim Modifiers <i class="material-icons">control_point</i>\n          </h6>\n          <div class="form-group aim-modifiers-list">\n            ${populateAimMods()}\n          </div>\n        </div>\n      </div>\n    </div>\n    <div class="additional-info">\n      <h6 class="category-title">\n          Wounds <i class="material-icons reset-wounds">replay</i>\n      </h6>\n      <div class="wounds-block">\n        <div class="wound-block">\n          <div class="wound-title">\n              Light\n          </div>\n          <div class="wound-markers">\n              <div class="wound-square"></div>\n              <div class="wound-square"></div>\n              <div class="wound-square"></div>\n              <div class="wound-square"></div>\n          </div>\n          <div class="wound-hint">\n              Stun=0\n          </div>\n        </div>\n        <div class="wound-block">\n          <div class="wound-title">\n              Serious\n          </div>\n          <div class="wound-markers">\n              <div class="wound-square"></div>\n              <div class="wound-square"></div>\n              <div class="wound-square"></div>\n              <div class="wound-square"></div>\n          </div>\n          <div class="wound-hint">\n              Stun=-1\n          </div>\n        </div>\n        <div class="wound-block">\n          <div class="wound-title">\n              Critical\n          </div>\n          <div class="wound-markers">\n              <div class="wound-square"></div>\n              <div class="wound-square"></div>\n              <div class="wound-square"></div>\n              <div class="wound-square"></div>\n          </div>\n          <div class="wound-hint">\n              Stun=-2\n          </div>\n        </div>\n        <div class="wound-block">\n          <div class="wound-title">\n              Mortal 0\n          </div>\n          <div class="wound-markers">\n              <div class="wound-square"></div>\n              <div class="wound-square"></div>\n              <div class="wound-square"></div>\n              <div class="wound-square"></div>\n          </div>\n          <div class="wound-hint">\n              Stun=-3\n          </div>\n        </div>\n        <div class="wound-block">\n          <div class="wound-title">\n              Mortal 1\n          </div>\n          <div class="wound-markers">\n              <div class="wound-square"></div>\n              <div class="wound-square"></div>\n              <div class="wound-square"></div>\n              <div class="wound-square"></div>\n          </div>\n          <div class="wound-hint">\n              Stun=-4\n          </div>\n        </div>\n        <div class="wound-block">\n          <div class="wound-title">\n              Mortal 2\n          </div>\n          <div class="wound-markers">\n              <div class="wound-square"></div>\n              <div class="wound-square"></div>\n              <div class="wound-square"></div>\n              <div class="wound-square"></div>\n          </div>\n          <div class="wound-hint">\n              Stun=-5\n          </div>\n        </div>\n        <div class="wound-block">\n          <div class="wound-title">\n              Mortal 3\n          </div>\n          <div class="wound-markers">\n              <div class="wound-square"></div>\n              <div class="wound-square"></div>\n              <div class="wound-square"></div>\n              <div class="wound-square"></div>\n          </div>\n          <div class="wound-hint">\n              Stun=-6\n          </div>\n        </div>\n        <div class="wound-block">\n          <div class="wound-title">\n              Mortal 4\n          </div>\n          <div class="wound-markers">\n              <div class="wound-square"></div>\n              <div class="wound-square"></div>\n              <div class="wound-square"></div>\n              <div class="wound-square"></div>\n          </div>\n          <div class="wound-hint">\n              Stun=-7\n          </div>\n        </div>\n        <div class="wound-block">\n          <div class="wound-title">\n              Mortal 5\n          </div>\n          <div class="wound-markers">\n              <div class="wound-square"></div>\n              <div class="wound-square"></div>\n              <div class="wound-square"></div>\n              <div class="wound-square"></div>\n          </div>\n          <div class="wound-hint">\n              Stun=-8\n          </div>\n        </div>\n        <div class="wound-block">\n          <div class="wound-title">\n              Mortal 6\n          </div>\n          <div class="wound-markers">\n              <div class="wound-square"></div>\n              <div class="wound-square"></div>\n              <div class="wound-square"></div>\n              <div class="wound-square"></div>\n          </div>\n          <div class="wound-hint">\n              Stun=-9\n          </div>\n        </div>\n      </div>\n      <h6 class="category-title">\n      Fighter Stats <i class="material-icons">control_point</i>\n   </h6>\n   <div class="fighter-stats">\n      <div class="form-group fighter-stat-row">\n         <label for="ref">REF (INITIAL/DYNAMIC)</label>\n         <div class="multiple-inputs">\n            <div class="input-block">\n                <span class="input-group-btn">\n                  <button type="button" class="quantity-left-minus btn btn-danger btn-number decrement"  data-type="minus" data-field="">\n                    -\n                  </button>\n                </span>\n                <input type="number" class="form-control initial-ref" aria-describedby="ref-hint" placeholder="REF" value="0">\n                <span class="input-group-btn">\n                  <button type="button" class="quantity-right-plus btn btn-success btn-number increment" data-type="plus" data-field="">\n                    +\n                  </button>\n              </span>\n            </div>\n            <span class="seperator">\n                /\n            </span>\n            <div class="input-block">\n                <span class="input-group-btn">\n                  <button type="button" class="quantity-left-minus btn btn-danger btn-number decrement"  data-type="minus" data-field="">\n                    -\n                  </button>\n                </span>\n                <input type="number" class="form-control ref" aria-describedby="ref-hint" placeholder="REF" value="0">\n                <span class="input-group-btn">\n                  <button type="button" class="quantity-right-plus btn btn-success btn-number increment" data-type="plus" data-field="">\n                    +\n                  </button>\n              </span>\n            </div>\n          </div>\n         <small id="ref-hint" class="form-text text-muted">Only dynamic stat is used for calculations.</small>\n      </div>\n      <div class="form-group fighter-stat-row">\n        <label for="body">BODY (INITIAL/DYNAMIC)</label>\n        <div class="multiple-inputs">\n        <div class="input-block">\n           <span class="input-group-btn">\n              <button type="button" class="quantity-left-minus btn btn-danger btn-number decrement"  data-type="minus" data-field="">\n                -\n              </button>\n           </span>\n           <input type="number" class="form-control initial-body" aria-describedby="body-hint" placeholder="BODY" value="0">\n           <span class="input-group-btn">\n              <button type="button" class="quantity-right-plus btn btn-success btn-number increment" data-type="plus" data-field="">\n                +\n              </button>\n          </span>\n        </div>\n        <span class="seperator">\n           /\n        </span>\n        <div class="input-block">\n           <span class="input-group-btn">\n              <button type="button" class="quantity-left-minus btn btn-danger btn-number decrement"  data-type="minus" data-field="">\n                -\n              </button>\n           </span>\n           <input type="number" class="form-control body" aria-describedby="body-hint" placeholder="BODY" value="0">\n           <span class="input-group-btn">\n              <button type="button" class="quantity-right-plus btn btn-success btn-number increment" data-type="plus" data-field="">\n                +\n              </button>\n          </span>\n        </div>\n     </div>\n        <small id="body-hint" class="form-text text-muted">Only dynamic stat is used for calculations.</small>\n      </div>\n      <div class="form-group fighter-stat-row">\n         <label for="btm">BTM (INITIAL/DYNAMIC)</label>\n         <div class="multiple-inputs">\n            <div class="input-block">\n                <span class="input-group-btn">\n                  <button type="button" class="quantity-left-minus btn btn-danger btn-number decrement"  data-type="minus" data-field="">\n                    -\n                  </button>\n                </span>\n                <input type="number" class="form-control initial-btm" aria-describedby="btm-hint" placeholder="BTM" value="0">\n                <span class="input-group-btn">\n                  <button type="button" class="quantity-right-plus btn btn-success btn-number increment" data-type="plus" data-field="">\n                    +\n                  </button>\n              </span>\n            </div>\n            <span class="seperator">\n                /\n            </span>\n            <div class="input-block">\n                <span class="input-group-btn">\n                  <button type="button" class="quantity-left-minus btn btn-danger btn-number decrement"  data-type="minus" data-field="">\n                    -\n                  </button>\n                </span>\n                <input type="number" class="form-control btm" aria-describedby="btm-hint" placeholder="BTM" value="0">\n                <span class="input-group-btn">\n                  <button type="button" class="quantity-right-plus btn btn-success btn-number increment" data-type="plus" data-field="">\n                    +\n                  </button>\n              </span>\n            </div>\n          </div>\n         <small id="btm-hint" class="form-text text-muted">Only dynamic stat is used for calculations.</small>\n      </div>\n      <div class="form-group fighter-stat-row">\n         <label for="wpn">Weapon Skill</label>\n         <div class="input-block">\n            <span class="input-group-btn">\n                <button type="button" class="quantity-left-minus btn btn-danger btn-number decrement"  data-type="minus" data-field="">\n                  -\n                </button>\n            </span>\n            <input type="number" class="form-control wpn" aria-describedby="wpn-hint" placeholder="Weapon Skill" value="0">\n            <span class="input-group-btn">\n                <button type="button" class="quantity-right-plus btn btn-success btn-number increment" data-type="plus" data-field="">\n                  +\n                </button>\n            </span>\n         </div>\n         <small id="wpn-hint" class="form-text text-muted">One good shot can solve any problem.</small>\n      </div>\n      <div class="form-group fighter-stat-row">\n            <label for="def">Defensive Skill</label>\n            <div class="input-block">\n                <span class="input-group-btn">\n                  <button type="button" class="quantity-left-minus btn btn-danger btn-number decrement"  data-type="minus" data-field="">\n                    -\n                  </button>\n                </span>\n                <input type="number" class="form-control def" aria-describedby="def-hint" placeholder="Defensive Skill" value="0">\n                <span class="input-group-btn">\n                  <button type="button" class="quantity-right-plus btn btn-success btn-number increment" data-type="plus" data-field="">\n                    +\n                  </button>\n                </span>\n            </div>\n            <small id="def-hint" class="form-text text-muted">(Athletics/Parry/Blocking/Brawling, etc.)</small>\n        </div>\n      <div class="form-group fighter-stat-row">\n         <label for="mods">Other Aim Modifiers</label>\n         <input type="text" class="form-control mods" aria-describedby="mods-hint" placeholder="Mods" value="">\n         <small id="mods-hint" class="form-text text-muted">Write mods with "space" button. For instance : -1 2 -3.</small>\n      </div>\n      </div>\n    </div>\n  </div>`),"goon"===n?930===$(".goons-block").height()&&$(".goons-block").addClass("bottom-bordered"):930===$(".bois-block").height()&&$(".bois-block").addClass("bottom-bordered")}function removeGoon(t,n){$(`.${n}.${t}`).remove();const e=$(`.${n}`);if(e.length>0)for(let a=t;a<e.length;a++)$(e[a]).attr("class",`${n} ${a}`);"goon"===n?$(".goons-block").height()<930&&$(".goons-block").removeClass("bottom-bordered"):$(".bois-block").height()<930&&$(".bois-block").removeClass("bottom-bordered")}function debounce(t,n,e){var a;return function(){var s=this,o=arguments,i=function(){a=null,e||t.apply(s,o)},l=e&&!a;clearTimeout(a),a=setTimeout(i,n),l&&t.apply(s,o)}}function getActiveModsList(t){const n=[];return $(t).find(".modifier.active").each(((t,e)=>{const a=$(e).find(".modifier-text").text().trim();n.push(a)})),n}function formGoonObj(t){const n=t.attr("class").split(/\s+/),e=n[0],a=n[1],s=$(`.${n[0]}.${n[1]} .wound-square.active-confirmed`).length,o=t.find(".head").val(),i=t.find(".torso").val(),l=t.find(".l-arm").val(),d=t.find(".r-arm").val(),r=t.find(".l-leg").val(),c=t.find(".r-leg").val(),u=t.find(".head-hp").val(),p=t.find(".torso-hp").val(),b=t.find(".l-arm-hp").val(),m=t.find(".r-arm-hp").val(),v=t.find(".l-leg-hp").val(),f=t.find(".r-leg-hp").val(),g=t.find(".fighter-stat-row .initial-ref").val(),h=t.find(".fighter-stat-row .ref").val(),y=t.find(".fighter-stat-row .initial-body").val(),w=t.find(".fighter-stat-row .body").val(),S=t.find(".fighter-stat-row .initial-btm").val(),k=t.find(".fighter-stat-row .btm").val(),C=t.find(".fighter-stat-row .wpn").val(),q=t.find(".fighter-stat-row .def").val(),A=t.find(".fighter-stat-row .mods").val(),M=t.find(".goon-name").val(),I=getActiveModsList(t);return{goonTemplate:{id:parseInt(a),woundLevel:s,bodyStats:{armor:{head:o?parseInt(o):0,torso:i?parseInt(i):0,lArm:l?parseInt(l):0,rArm:d?parseInt(d):0,lLeg:r?parseInt(r):0,rLeg:c?parseInt(c):0},limbs:{head:u||"",torso:p||"",lArm:b||"",rArm:m||"",lLeg:v||"",rLeg:f||""}},fightStats:{initialRef:g?parseInt(g):0,ref:h?parseInt(h):0,initialBody:y?parseInt(y):0,body:w?parseInt(w):0,initialBtm:S?parseInt(S):0,btm:k?parseInt(k):0,wpn:C?parseInt(C):0,def:q?parseInt(q):0,mods:A||"",selectedMods:I||[]},additionalStats:{name:M||""}},type:e}}